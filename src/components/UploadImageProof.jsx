import { CarReader } from "@ipld/car";
import { importDAG } from "@ucanto/core/delegation";
import * as Signer from "@ucanto/principal/ed25519";
import * as Client from "@web3-storage/w3up-client";
import { StoreMemory } from "@web3-storage/w3up-client/stores/memory";
import { Buffer } from "buffer";
import React, { useState } from "react";
import "../styles/UploadImageProof.css";

const key =
    "MgCZlQq21mcNyKT8KMDYvCUPwGrp7af19HlDBjBj7HzZmLO0B18LJnhM4F6tqe69aWtpJLMptnqroFrB1nnelWqt8/II=";

const PROOF =
    "4RAPMAZQByAG8AbwB0AHMAxwBnAHYAZQByAHMAaQBvAG4AAQAYJQYAAQBxABIAIAByAAIltwAZAEcABQA7AB0AxgPRAHkARQChADwlISO8AF4AEADGA0IAUiX6AGslxwCrAKMAvACTA/EAcgA5AH0AvwBhAHMAWABEAMYD7QADAEAAxAD6ACAjewB3AEcASgChADsAsQNjAGAATwBrAGQAZCJWAOUADACSAccAayUdAHQAJgBBABUATQAMAMYAoAA4AFMleQBhAC8AZgBEAEEAGiJIADwlZwAGAC4A8gAdACsAewCqAD4APAApIiwAZwANAAoAISO1AxMAsgDHAFMlFQAOAGEAdgBlADAALgA5AC4AMQBjAGEAdAB0AOoA8wBjAGMAYQBuAGcAcwBwAGEAYwBlAC8AKgBkAHcAaQB0AGgAeAA4AGQAaQBkADoAawBlAHkAOgB6ADYATQBrAHYAVwBrAHQAVgB1AFYAeQBBAHAAYwBHAEUAbQBiAFQAeABxAEEARgBLAEIAaQBYADgAOQB0AFoARAA4ADIAeABKAFoAdgBGAFcAZgBiAEMASABSAFcAaQDzAGMAYwBhAG4AZgBiAGwAbwBiAC8AKgBkAHcAaQB0AGgAeAA4AGQAaQBkADoAawBlAHkAOgB6ADYATQBrAHYAVwBrAHQAVgB1AFYAeQBBAHAAYwBHAEUAbQBiAFQAeABxAEEARgBLAEIAaQBYADgAOQB0AFoARAA4ADIAeABKAFoAdgBGAFcAZgBiAEMASABSAFcAaQDzAGMAYwBhAG4AZwBpAG4AZABlAHgALwAqAGQAdwBpAHQAaAB4ADgAZABpAGQAOgBrAGUAeQA6AHoANgBNAGsAdgBXAGsAdABWAHUAVgB5AEEAcABjAEcARQBtAGIAVAB4AHEAQQBGAEsAQgBpAFgAOAA5AHQAWgBEADgAMgB4AEoAWgB2AEYAVwBmAGIAQwBIAFIAVwBpAPMAYwBjAGEAbgBnAHMAdABvAHIAZQAvACoAZAB3AGkAdABoAHgAOABkAGkAZAA6AGsAZQB5ADoAegA2AE0AawB2AFcAawB0AFYAdQBWAHkAQQBwAGMARwBFAG0AYgBUAHgAcQBBAEYASwBCAGkAWAA4ADkAdABaAEQAOAAyAHgASgBaAHYARgBXAGYAYgBDAEgAUgBXAGkA8wBjAGMAYQBuAGgAdQBwAGwAbwBhAGQALwAqAGQAdwBpAHQAaAB4ADgAZABpAGQAOgBrAGUAeQA6AHoANgBNAGsAdgBXAGsAdABWAHUAVgB5AEEAcABjAEcARQBtAGIAVAB4AHEAQQBGAEsAQgBpAFgAOAA5AHQAWgBEADgAMgB4AEoAWgB2AEYAVwBmAGIAQwBIAFIAVwBpAPMAYwBjAGEAbgBoAGEAYwBjAGUAcwBzAC8AKgBkAHcAaQB0AGgAeAA4AGQAaQBkADoAawBlAHkAOgB6ADYATQBrAHYAVwBrAHQAVgB1AFYAeQBBAHAAYwBHAEUAbQBiAFQAeABxAEEARgBLAEIAaQBYADgAOQB0AFoARAA4ADIAeABKAFoAdgBGAFcAZgBiAEMASABSAFcAaQDzAGMAYwBhAG4AagBmAGkAbABlAGMAbwBpAG4ALwAqAGQAdwBpAHQAaAB4ADgAZABpAGQAOgBrAGUAeQA6AHoANgBNAGsAdgBXAGsAdABWAHUAVgB5AEEAcABjAEcARQBtAGIAVAB4AHEAQQBGAEsAQgBpAFgAOAA5AHQAWgBEADgAMgB4AEoAWgB2AEYAVwBmAGIAQwBIAFIAVwBpAPMAYwBjAGEAbgBnAHUAcwBhAGcAZQAvACoAZAB3AGkAdABoAHgAOABkAGkAZAA6AGsAZQB5ADoAegA2AE0AawB2AFcAawB0AFYAdQBWAHkAQQBwAGMARwBFAG0AYgBUAHgAcQBBAEYASwBCAGkAWAA4ADkAdABaAEQAOAAyAHgASgBaAHYARgBXAGYAYgBDAEgAUgBXAGkAYwBhAHUAZABYACIAxgMBAE0AWwCgAAkAogAlACwlECV/IPIAoQDsAPIAaiXEAOIAGiIhI7UDqgBkJSQlbAAeALAAHwAxAEAALCUsJUIA/wBjAGUAeABwABoAaQAgAA8AUiVjAGYAYwB0APwA7QBlAHMAcABhAGMAZQDtAGQAbgBhAG0AZQBqAGIAYwAtAHAAcgBvAGoAZQBjAHQAYwBpAHMAcwBYACIAxgMBALUD4QBYAKEAICPmAFMlsADtAOUAPgBqAB0ABgAUJfcAxAMFAPsAWCXEAEEAHQCnIA8AaQA7AGYAVwC/AHkA7wBjAHAAcgBmAMcAGCUGAAEAcQASACAAcgACJbcAGQBHAAUAOwAdAMYD0QB5AEUAoQA8JSEjvABeABAAxgNCAFIl+gBrJccAqwCjALwAkwPxAHIAOQB9AL8AYQBzAFgARADGA+0AAwBAAMQA+gAgI3sAdwBHAEoAoQA7ALEDYwBgAE8AawBkAGQiVgDlAAwAkgHHAGslHQB0ACYAQQAVAE0ADADGAKAAOABTJXkAYQAvAGYARABBABoiSAA8JWcABgAuAPIAHQArAHsAqgA+ADwAKSIsAGcADQAKACEjtQMTALIAxwBTJRUADgBhAHYAZQAwAC4AOQAuADEAYwBhAHQAdADqAPMAYwBjAGEAbgBnAHMAcABhAGMAZQAvACoAZAB3AGkAdABoAHgAOABkAGkAZAA6AGsAZQB5ADoAegA2AE0AawB2AFcAawB0AFYAdQBWAHkAQQBwAGMARwBFAG0AYgBUAHgAcQBBAEYASwBCAGkAWAA4ADkAdABaAEQAOAAyAHgASgBaAHYARgBXAGYAYgBDAEgAUgBXAGkA8wBjAGMAYQBuAGYAYgBsAG8AYgAvACoAZAB3AGkAdABoAHgAOABkAGkAZAA6AGsAZQB5ADoAegA2AE0AawB2AFcAawB0AFYAdQBWAHkAQQBwAGMARwBFAG0AYgBUAHgAcQBBAEYASwBCAGkAWAA4ADkAdABaAEQAOAAyAHgASgBaAHYARgBXAGYAYgBDAEgAUgBXAGkA8wBjAGMAYQBuAGcAaQBuAGQAZQB4AC8AKgBkAHcAaQB0AGgAeAA4AGQAaQBkADoAawBlAHkAOgB6ADYATQBrAHYAVwBrAHQAVgB1AFYAeQBBAHAAYwBHAEUAbQBiAFQAeABxAEEARgBLAEIAaQBYADgAOQB0AFoARAA4ADIAeABKAFoAdgBGAFcAZgBiAEMASABSAFcAaQDzAGMAYwBhAG4AZwBzAHQAbwByAGUALwAqAGQAdwBpAHQAaAB4ADgAZABpAGQAOgBrAGUAeQA6AHoANgBNAGsAdgBXAGsAdABWAHUAVgB5AEEAcABjAEcARQBtAGIAVAB4AHEAQQBGAEsAQgBpAFgAOAA5AHQAWgBEADgAMgB4AEoAWgB2AEYAVwBmAGIAQwBIAFIAVwBpAPMAYwBjAGEAbgBoAHUAcABsAG8AYQBkAC8AKgBkAHcAaQB0AGgAeAA4AGQAaQBkADoAawBlAHkAOgB6ADYATQBrAHYAVwBrAHQAVgB1AFYAeQBBAHAAYwBHAEUAbQBiAFQAeABxAEEARgBLAEIAaQBYADgAOQB0AFoARAA4ADIAeABKAFoAdgBGAFcAZgBiAEMASABSAFcAaQDzAGMAYwBhAG4AaABhAGMAYwBlAHMAcwAvACoAZAB3AGkAdABoAHgAOABkAGkAZAA6AGsAZQB5ADoAegA2AE0AawB2AFcAawB0AFYAdQBWAHkAQQBwAGMARwBFAG0AYgBUAHgAcQBBAEYASwBCAGkAWAA4ADkAdABaAEQAOAAyAHgASgBaAHYARgBXAGYAYgBDAEgAUgBXAGkA8wBjAGMAYQBuAGoAZgBpAGwAZQBjAG8AaQBuAC8AKgBkAHcAaQB0AGgAeAA4AGQAaQBkADoAawBlAHkAOgB6ADYATQBrAHYAVwBrAHQAVgB1AFYAeQBBAHAAYwBHAEUAbQBiAFQAeABxAEEARgBLAEIAaQBYADgAOQB0AFoARAA4ADIAeABKAFoAdgBGAFcAZgBiAEMASABSAFcAaQDzAGMAYwBhAG4AZwB1AHMAYQBnAGUALwAqAGQAdwBpAHQAaAB4ADgAZABpAGQAOgBrAGUAeQA6AHoANgBNAGsAdgBXAGsAdABWAHUAVgB5AEEAcABjAEcARQBtAGIAVAB4AHEAQQBGAEsAQgBpAFgAOAA5AHQAWgBEADgAMgB4AEoAWgB2AEYAVwBmAGIAQwBIAFIAVwBpAGMAYQB1AGQAWAAiAMYDAQBNAFsAoAAJAKIAJQAsJRAlfyDyAKEA7ADyAGolxADiABoiISO1A6oAZCUkJWwAHgCwAB8AMQBAACwlLCVCAP8AYwBlAHgAcAAaAGkAIAAPAFIlYwBmAGMAdAD8AO0AZQBzAHAAYQBjAGUA7QBkAG4AYQBtAGUAagBiAGMALQBwAHIAbwBqAGUAYwB0AGMAaQBzAHMAWAAiAMYDAQC1A+EAWAChACAj5gBTJbAA7QDlAD4AagAdAAYAFCX3AMQDBQD7AFglxABBAB0ApyAPAGkAOwBmAFcAvwB5AO8AYwBwAHIAZgDHABglBgABAHEAEgAgAHIAAiW3ABkARwAFADsAHQDGA9EAeQBFAKEAPCUhI7wAXgAQAMYDQgBSJfoAayXHAKsAowC8AJMD8QByADkAfQC/AGEAcwBYAEQAxgPtAAMAQADEAPoAICN7AHcARwBKAKEAOwCxA2MAYABPAGsAZABkIlYA5QAMAJIBxwBrJR0AdAAmAEEAFQBNAAwAxgCgADgAUyV5AGEALwBmAEQAQQAaIkgAPCVnAAYALgDyAB0AKwB7AKoAPgA8ACkiLABnAA0ACgAhI7UDEwCyAMcAUyUVAA4AYQB2AGUAMAAuADkALgAxAGMAYQB0AHQA6gDzAGMAYwBhAG4AZwBzAHAAYQBjAGUALwAqAGQAdwBpAHQAaAB4ADgAZABpAGQAOgBrAGUAeQA6AHoANgBNAGsAdgBXAGsAdABWAHUAVgB5AEEAcABjAEcARQBtAGIAVAB4AHEAQQBGAEsAQgBpAFgAOAA5AHQAWgBEADgAMgB4AEoAWgB2AEYAVwBmAGIAQwBIAFIAVwBpAPMAYwBjAGEAbgBmAGIAbABvAGIALwAqAGQAdwBpAHQAaAB4ADgAZABpAGQAOgBrAGUAeQA6AHoANgBNAGsAdgBXAGsAdABWAHUAVgB5AEEAcABjAEcARQBtAGIAVAB4AHEAQQBGAEsAQgBpAFgAOAA5AHQAWgBEADgAMgB4AEoAWgB2AEYAVwBmAGIAQwBIAFIAVwBpAPMAYwBjAGEAbgBnAGkAbgBkAGUAeAAvACoAZAB3AGkAdABoAHgAOABkAGkAZAA6AGsAZQB5ADoAegA2AE0AawB2AFcAawB0AFYAdQBWAHkAQQBwAGMARwBFAG0AYgBUAHgAcQBBAEYASwBCAGkAWAA4ADkAdABaAEQAOAAyAHgASgBaAHYARgBXAGYAYgBDAEgAUgBXAGkA8wBjAGMAYQBuAGcAcwB0AG8AcgBlAC8AKgBkAHcAaQB0AGgAeAA4AGQAaQBkADoAawBlAHkAOgB6ADYATQBrAHYAVwBrAHQAVgB1AFYAeQBBAHAAYwBHAEUAbQBiAFQAeABxAEEARgBLAEIAaQBYADgAOQB0AFoARAA4ADIAeABKAFoAdgBGAFcAZgBiAEMASABSAFcAaQDzAGMAYwBhAG4AaAB1AHAAbABvAGEAZAAvACoAZAB3AGkAdABoAHgAOABkAGkAZAA6AGsAZQB5ADoAegA2AE0AawB2AFcAawB0AFYAdQBWAHkAQQBwAGMARwBFAG0AYgBUAHgAcQBBAEYASwBCAGkAWAA4ADkAdABaAEQAOAAyAHgASgBaAHYARgBXAGYAYgBDAEgAUgBXAGkA8wBjAGMAYQBuAGgAYQBjAGMAZQBzAHMALwAqAGQAdwBpAHQAaAB4ADgAZABpAGQAOgBrAGUAeQA6AHoANgBNAGsAdgBXAGsAdABWAHUAVgB5AEEAcABjAEcARQBtAGIAVAB4AHEAQQBGAEsAQgBpAFgAOAA5AHQAWgBEADgAMgB4AEoAWgB2AEYAVwBmAGIAQwBIAFIAVwBpAPMAYwBjAGEAbgBqAGYAaQBsAGUAYwBvAGkAbgAvACoAZAB3AGkAdABoAHgAOABkAGkAZAA6AGsAZQB5ADoAegA2AE0AawB2AFcAawB0AFYAdQBWAHkAQQBwAGMARwBFAG0AYgBUAHgAcQBBAEYASwBCAGkAWAA4ADkAdABaAEQAOAAyAHgASgBaAHYARgBXAGYAYgBDAEgAUgBXAGkA8wBjAGMAYQBuAGcAdQBzAGEAZwBlAC8AKgBkAHcAaQB0AGgAeAA4AGQAaQBkADoAawBlAHkAOgB6ADYATQBrAHYAVwBrAHQAVgB1AFYAeQBBAHAAYwBHAEUAbQBiAFQAeABxAEEARgBLAEIAaQBYADgAOQB0AFoARAA4ADIAeABKAFoAdgBGAFcAZgBiAEMASABSAFcAaQBjAGEAdQBkAFgAIgDGAwEATQBbAKAACQCiACUALCUQJX8g8gChAOwA8gBqJcQA4gAaIiEjtQOqAGQlJCVsAB4AsAAfADEAQAAsJSwlQgD/AGMAZQB4AHAAGgBpACAADwBSJWMAZgBjAHQA/ADtAGUAcwBwAGEAYwBlAO0AZABuAGEAbQBlAGoAYgBjAC0AcAByAG8AagBlAGMAdABjAGkAcwBzAFgAIgDGAwEAtQPhAFgAoQAgI+YAUyWwAO0A5QA+AGoAHQAGABQl9wDEAwUA+wBYJcQAQQAdAKcgDwBpADsAZgBXAL8AeQDvAGMAcAByAGYAxwAYJQYAAQBxABIAIAByAAIltwAZAEcABQA7AB0AxgPRAHkARQChADwlISO8AF4AEADGA0IAUiX6AGslxwCrAKMAvACTA/EAcgA5AH0AvwBhAHMAWABEAMYD7QADAEAAxAD6ACAjewB3AEcASgChADsAsQNjAGAATwBrAGQAZCJWAOUADACSAccAayUdAHQAJgBBABUATQAMAMYAoAA4AFMleQBhAC8AZgBEAEEAGiJIADwlZwAGAC4A8gAdACsAewCqAD4APAApIiwAZwANAAoAISO1AxMAsgDHAFMlFQAOAGEAdgBlADAALgA5AC4AMQBjAGEAdAB0AOoA8wBjAGMAYQBuAGcAcwBwAGEAYwBlAC8AKgBkAHcAaQB0AGgAeAA4AGQAaQBkADoAawBlAHkAOgB6ADYATQBrAHYAVwBrAHQAVgB1AFYAeQBBAHAAYwBHAEUAbQBiAFQAeABxAEEARgBLAEIAaQBYADgAOQB0AFoARAA4ADIAeABKAFoAdgBGAFcAZgBiAEMASABSAFcAaQDzAGMAYwBhAG4AZgBiAGwAbwBiAC8AKgBkAHcAaQB0AGgAeAA4AGQAaQBkADoAawBlAHkAOgB6ADYATQBrAHYAVwBrAHQAVgB1AFYAeQBBAHAAYwBHAEUAbQBiAFQAeABxAEEARgBLAEIAaQBYADgAOQB0AFoARAA4ADIAeABKAFoAdgBGAFcAZgBiAEMASABSAFcAaQDzAGMAYwBhAG4AZwBpAG4AZABlAHgALwAqAGQAdwBpAHQAaAB4ADgAZABpAGQAOgBrAGUAeQA6AHoANgBNAGsAdgBXAGsAdABWAHUAVgB5AEEAcABjAEcARQBtAGIAVAB4AHEAQQBGAEsAQgBpAFgAOAA5AHQAWgBEADgAMgB4AEoAWgB2AEYAVwBmAGIAQwBIAFIAVwBpAPMAYwBjAGEAbgBnAHMAdABvAHIAZQAvACoAZAB3AGkAdABoAHgAOABkAGkAZAA6AGsAZQB5ADoAegA2AE0AawB2AFcAawB0AFYAdQBWAHkAQQBwAGMARwBFAG0AYgBUAHgAcQBBAEYASwBCAGkAWAA4ADkAdABaAEQAOAAyAHgASgBaAHYARgBXAGYAYgBDAEgAUgBXAGkA8wBjAGMAYQBuAGgAdQBwAGwAbwBhAGQALwAqAGQAdwBpAHQAaAB4ADgAZABpAGQAOgBrAGUAeQA6AHoANgBNAGsAdgBXAGsAdABWAHUAVgB5AEEAcABjAEcARQBtAGIAVAB4AHEAQQBGAEsAQgBpAFgAOAA5AHQAWgBEADgAMgB4AEoAWgB2AEYAVwBmAGIAQwBIAFIAVwBpAPMAYwBjAGEAbgBoAGEAYwBjAGUAcwBzAC8AKgBkAHcAaQB0AGgAeAA4AGQAaQBkADoAawBlAHkAOgB6ADYATQBrAHYAVwBrAHQAVgB1AFYAeQBBAHAAYwBHAEUAbQBiAFQAeABxAEEARgBLAEIAaQBYADgAOQB0AFoARAA4ADIAeABKAFoAdgBGAFcAZgBiAEMASABSAFcAaQDzAGMAYwBhAG4AagBmAGkAbABlAGMAbwBpAG4ALwAqAGQAdwBpAHQAaAB4ADgAZABpAGQAOgBrAGUAeQA6AHoANgBNAGsAdgBXAGsAdABWAHUAVgB5AEEAcABjAEcARQBtAGIAVAB4AHEAQQBGAEsAQgBpAFgAOAA5AHQAWgBEADgAMgB4AEoAWgB2AEYAVwBmAGIAQwBIAFIAVwBpAPMAYwBjAGEAbgBnAHUAcwBhAGcAZQAvACoAZAB3AGkAdABoAHgAOABkAGkAZAA6AGsAZQB5ADoAegA2AE0AawB2AFcAawB0AFYAdQBWAHkAQQBwAGMARwBFAG0AYgBUAHgAcQBBAEYASwBCAGkAWAA4ADkAdABaAEQAOAAyAHgASgBaAHYARgBXAGYAYgBDAEgAUgBXAGkAYwBhAHUAZABYACIAxgMBAE0AWwCgAAkAogAlACwlECV/IPIAoQDsAPIAaiXEAOIAGiIhI7UDqgBkJSQlbAAeALAAHwAxAEAALCUsJUIA/wBjAGUAeABwABoAaQAgAA8AUiVjAGYAYwB0APwA7QBlAHMAcABhAGMAZQDtAGQAbgBhAG0AZQBqAGIAYwAtAHAAcgBvAGoAZQBjAHQAYwBpAHMAcwBYACIAxgMBALUD4QBYAKEAICPmAFMlsADtAOUAPgBqAB0ABgAUJfcAxAMFAPsAWCXEAEEAHQCnIA8AaQA7AGYAVwC/AHkA7wBjAHAAcgBmAMcAZSUFAAEAcQASACAAYyXnABsA8QAIAHkANAAjABAjfyA9AFkA4QAjAO4A7ABAAOEAYyVbAEgiIwAnAMMDEQAmABUAdwCTA3gA+gBfAL8AYQBzAFgARADGA+0AAwBAAGQAowBZAE0AXgAZAGwlViXpABoAZyVzABsAXwApIg0ACgDWACcAmAMRAAAlDgC8AAkACQDHAEEAGCV3AGAlVyVoJVsAuwDxAOwAZwAyACIASQD2AFcAfgAZIj8AXgBbAEMAxABJAB0ATwDqALsAawB+AEkAiCVZAGAlowBlIhAjAwBhAHYAZQAwAC4AOQAuADEAYwBhAHQAdADkAPMAYwBjAGEAbgBoAGIAbABvAGIALwBhAGQAZABkAHcAaQB0AGgAeAA4AGQAaQBkADoAawBlAHkAOgB6ADYATQBrAHYAVwBrAHQAVgB1AFYAeQBBAHAAYwBHAEUAbQBiAFQAeABxAEEARgBLAEIAaQBYADgAOQB0AFoARAA4ADIAeABKAFoAdgBGAFcAZgBiAEMASABSAFcAaQDzAGMAYwBhAG4AaQBpAG4AZABlAHgALwBhAGQAZABkAHcAaQB0AGgAeAA4AGQAaQBkADoAawBlAHkAOgB6ADYATQBrAHYAVwBrAHQAVgB1AFYAeQBBAHAAYwBHAEUAbQBiAFQAeABxAEEARgBLAEIAaQBYADgAOQB0AFoARAA4ADIAeABKAFoAdgBGAFcAZgBiAEMASABSAFcAaQDzAGMAYwBhAG4AbgBmAGkAbABlAGMAbwBpAG4ALwBvAGYAZgBlAHIAZAB3AGkAdABoAHgAOABkAGkAZAA6AGsAZQB5ADoAegA2AE0AawB2AFcAawB0AFYAdQBWAHkAQQBwAGMARwBFAG0AYgBUAHgAcQBBAEYASwBCAGkAWAA4ADkAdABaAEQAOAAyAHgASgBaAHYARgBXAGYAYgBDAEgAUgBXAGkA8wBjAGMAYQBuAGoAdQBwAGwAbwBhAGQALwBhAGQAZABkAHcAaQB0AGgAeAA4AGQAaQBkADoAawBlAHkAOgB6ADYATQBrAHYAVwBrAHQAVgB1AFYAeQBBAHAAYwBHAEUAbQBiAFQAeABxAEEARgBLAEIAaQBYADgAOQB0AFoARAA4ADIAeABKAFoAdgBGAFcAZgBiAEMASABSAFcAaQBjAGEAdQBkAFgAIgDGAwEAayUsJVQlpyATADgAFwC9AGoAewC7AFoAWgAMJUkALABpJW0ApyCsAKYDFgCRJXUApyB3ANEAWgC9AHwAfyDpAGMAZQB4AHAA9wBjAGYAYwB0APwA7QBlAHMAcABhAGMAZQDtAGQAbgBhAG0AZQBqAGIAYwAtAHAAcgBvAGoAZQBjAHQAYwBpAHMAcwBYACIAxgMBAE0AWwCgAAkAogAlACwlECV/IPIAoQDsAPIAaiXEAOIAGiIhI7UDqgBkJSQlbAAeALAAHwAxAEAALCUsJUIA/wBjAHAAcgBmAOQAaiUqAFgAJQAAAAEAcQASACAAcgACJbcAGQBHAAUAOwAdAMYD0QB5AEUAoQA8JSEjvABeABAAxgNCAFIl+gBrJccAqwCjALwAkwPxAHIAOQB9AGolKgBYACUAAAABAHEAEgAgAHIAAiW3ABkARwAFADsAHQDGA9EAeQBFAKEAPCUhI7wAXgAQAMYDQgBSJfoAayXHAKsAowC8AJMD8QByADkAfQBqJSoAWAAlAAAAAQBxABIAIAByAAIltwAZAEcABQA7AB0AxgPRAHkARQChADwlISO8AF4AEADGA0IAUiX6AGslxwCrAKMAvACTA/EAcgA5AH0AaiUqAFgAJQAAAAEAcQASACAAcgACJbcAGQBHAAUAOwAdAMYD0QB5AEUAoQA8JSEjvABeABAAxgNCAFIl+gBrJccAqwCjALwAkwPxAHIAOQB9AA0ACgA=";
async function makeStorageClient() {
    const principal = Signer.parse(key);
    const store = new StoreMemory();
    const client = await Client.create({ principal, store });

    const proof = await parseProof(PROOF);
    const space = await client.addSpace(proof);
    await client.setCurrentSpace(space.did());

    // await client.login("junkiat_lim@mymail.sutd.edu.sg");
    // await client.setCurrentSpace(
    //     "did:key:z6MkvWktVuVyApcGEmbTxqAFKBiX89tZD82xJZvFWfbCHRWi"
    // );
    return client;
}
async function parseProof(data) {
    const blocks = [];
    const reader = await CarReader.fromBytes(Buffer.from(data, "base64"));
    for await (const block of reader.blocks()) {
        blocks.push(block);
    }
    return importDAG(blocks);
}

export default function UploadImageProof() {
    const [file, setFile] = useState(null);

    const handleFileChange = (event) => {
        const file = event.target.files[0];
        if (file) {
            setFile(file);
        }
    };

    const uploadFile = async () => {
        if (file) {
            try {
                const client = await makeStorageClient();
                const directoryCid = await client.uploadDirectory(file);
                console.log("Stored file with CID:", directoryCid);
                alert("Upload successful. CID: " + directoryCid);
            } catch (error) {
                console.error("Error uploading file:", error);
                alert("Error uploading file");
            }
        } else {
            alert("No file selected");
        }
    };

    return (
        <div className="upload-container">
            <h1>Upload Image Proof</h1>
            <input
                type="file"
                className="file-input"
                onChange={handleFileChange}
                accept="image/*"
            />
            <button onClick={uploadFile}>Upload Image</button>
        </div>
    );
}
